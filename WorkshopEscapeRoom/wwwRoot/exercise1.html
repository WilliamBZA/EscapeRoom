<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Escape room fun!</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>

<body>
    <div>
        <div class="container">
            <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <div class="container-fluid">
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Exercises</a>
                                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                    <li><a class="dropdown-item active" href="exercise1.html">Exercise 1 - Intro to NanoFramework</a></li>
                                    <li><a class="dropdown-item" href="exercise2.html">Exercise 2 - Turning devices on/off</a></li>
                                    <li><a class="dropdown-item" href="exercise3.html">Exercise 3 - Responding to HTTP requests</a></li>
                                    <li><a class="dropdown-item" href="exercise4.html">Exercise 4 - Intro to Azure Service Bus</a></li>
                                    <li><a class="dropdown-item" href="exercise5.html">Exercise 5 - Pub/Sub</a></li>
                                    <li><a class="dropdown-item" href="exercise6.html">Exercise 6 - Dealing with failures</a></li>
                                    <li><a class="dropdown-item" href="exercise7.html">Exercise 7 - Building an efficient pipeline</a></li>
                                    <li><a class="dropdown-item" href="exercise8.html">Exercise 8 - Message Timeouts</a></li>
                                    <li><a class="dropdown-item" href="exercise9.html">Exercise 9 - Rate Limiting</a></li>
                                    <li><a class="dropdown-item" href="exercise10.html">Exercise 10 - Delayed Delivery</a></li>
                                    <li><a class="dropdown-item" href="exercise11.html">Exercise 11 - Further patterns to learn</a></li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="https://github.com/WilliamBZA/1DayDistributedSystemsThroughPlay/tree/main/">Code Repo</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="https://github.com/WilliamBZA/1DayDistributedSystemsThroughPlay/tree/main/exercises/solutions">Solutions</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>

        <div class="container heading">
            <div>
                <h1>Exercise 1:</h1>
                <h4>Deploy an application</h4>
            </div>
        </div>
        
        <div class="container exercisedetails">
            <div class="col-lg-12">
                <ul class="nav nav-tabs" id="exercise-headings" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="visualstudio-tab" type="button" data-bs-toggle="tab" data-bs-target="#visualstudio-tab-content" role="tab" aria-controls="visualstudio-tab-content" aria-selected="false">Visual Studio</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="vscode-tab" type="button" data-bs-toggle="tab" data-bs-target="#vscode-tab-content" role="tab" aria-controls="vscode-tab-content" aria-selected="true">VS Code</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="bonusexercise-tab" type="button" data-bs-toggle="tab" data-bs-target="#bonus-exercise-tab-content" role="tab" aria-controls="bonus-exercise-tab-content" aria-selected="true">Bonus exercises</button>
                    </li>
                </ul>
                
                <div class="tab-content" id="exerciseContent">
                    <div class="tab-pane show active" id="visualstudio-tab-content" role="tabpanel" aria-labelledby="visualstudio-tab" tabindex="0">
                        <h3>Deploying with Visual Studio</h3>

                        <div>
                            Deploying a NanoFramework application from Visual Studio is typically easy and involves only a few steps:
                        </div>

                        <div>
                            <ol>
                                <li>Make sure the correct device is selected in the extension</li>
                                <li>F5 to run the application</li>
                            </ol>
                        </div>

                        <h3 class="breadcrumb" id="vs-step1">1. Make sure the correct device is selected</h3>

                        <div>
                            The NanoFramework extension for Visual Studio adds a <code>Device Explorer</code> window with lists any compatible ESP32 devices that are connected
                            to the computer. To open the window, go to <code>View -> Other Windows -> Device Explorer</code>.
                            <img src="img/devicieexplorerwindow.png" />
                        </div>

                        <div>
                            Once this window is open, it will list all compatible devices connected to the computer (in this case, there should only be one). Select the
                            device you wish to flash. In the example below, the device is connected to <code>COM3</code> and is an <code>ESP32_REV3</code> image.
                        </div>
                        <img src="img/deviceselection.png" />
<!--
                        <h3 class="breadcrumb" id="vs-step2">2. Set content files to Copy Always</h3>

                        <div>
                            If there are any content files (e.g. html, js, css, or images) that need to be deployed along with the application, their <code>Build Action</code>
                            must be set to <code>Content</code> and the <code>Copy to Ouput Directory</code> setting must be set to <code>Always</code> or
                            <code>Copy if newer</code>.
                        </div>
                        <img src="img/buildaction.png" />

                        <div>
                            The build action will copy the files to the internal storage of the device, in the same folder path that they are in relative to the Visual Studio
                            solution. If you wish to change where the files are copied to, you can edit the <code>nfproj</code> file to specify the destination location
                            for the file you are copying.
                        </div>
                        <img src="img/customlocation.png" />
-->
                        <h3 class="breadcrumb" id="vs-step3">2. F5 to run the application</h3>

                        <div>
                            Your application is now ready to deploy. Hit <kbd>F5</kbd> to deploy and debug your application. The Visual Studio extension will now compile
                            your application, deploy it to the <a href="#vs-step1">selected device</a>, and start debugging. You can use most Visual Studio debugging tools (e.g.
                            Breakpoints, Quick Watch, Watches, etc.)
                        </div>
                        <img src="img/debugging.png" />

                        <h3 class="breadcrumb" id="vs-step4">3. Success!</h3>
                        <div>
                            If you managed to deploy everything successfully, you should see a message in your debugger:
                            <code>You have successfully deployed your first NanoFramework application at 01/01/1970 00:08:18</code>
                        </div>
                    </div>

                    <div class="tab-pane" id="vscode-tab-content" role="tabpanel" aria-labelledby="vscode-tab" tabindex="1">
                        <h3>Deploying with VSCode</h3>
                        <div>
                            There are 4 steps to deploying a NanoFramework application to a microcontroller like an ESP32 (which is what we are using during this workshop)
                            using the vscode add-on. At a summary, these steps are:
                        </div>

                        <div>
                            <ol>
                                <li>Build the project</li>
                                <li>Deploy the project</li>
                                <li>Add all Content Files to a deploy.json</li>
                                <li>Deploy the files</li>
                            </ol>
                        </div>
                        <hr/>

                        <h3 class="breadcrumb" id="vscode-step1">1. Build the application</h3>
                        <div>
                            <div>Open the <code>Command Palette</code> (Default shortcut is: <kbd>CTRL</kbd> + <kbd>SHIFT</kbd> + <kbd>P</kbd>) and search for <code>NanoFramework: Build Project</code>. Once found, run that command.</div>
                            <img src="img/build.png" class="text-center" />
                        </div>
                        
                        <div>
                            <div>The build command will present you with a parameter, asking you which solution you would like to build. Select the <code>1.Deployment\Deployment.sln</code> solution file.</div>
                            <img src="img/selectsolution.png" />
                        </div>
                        <div>
                            <div>The command will now compile the solution for you, getting it ready to deploy. The build log will look something like this:</div>
                            <img src="img/buildlog.png" />

                            <div>Once complete, your solution will be built. Now you need to deploy it.</div>
                        </div>
                        <hr/>

                        <h3 class="breadcrumb" id="vscode-step2">2. Deploy the application</h3>

                        <div>
                            <div>Open the <code>Command Palette</code> (Default shortcut is: <kbd>CTRL</kbd> + <kbd>SHIFT</kbd> + <kbd>P</kbd>) and search for <code>NanoFramework: Deploy Project</code>. Once found, run that command.</div>
                            <img src="img/deployproject.png" />
                        </div>
                        <div>
                            <div>The command will ask you for a parameter, asking you for which solution to deploy. Select the <code>1.Deployment\Deployment.sln</code> solution file.</div>
                            <img src="img/selectsolution.png" />
                            <div>The command will now ask you for a second parameter: which COM port to deploy to. Select the COM port that the device is <a href="findcomport.html">plugged into.</a></div>
                            <img src="img/comtarget.png" />
                        </div>
                        <div>
                            <div>
                                Your solution will now be deployed to the device. The output should look something like this:
                            </div>
                            <img src="img/deploylog.png" />
                        </div>
                        <!--<div>
                            <div>
                                With your solution deployed, you now need to deploy the static files that will be served by the device's web server.
                            </div>
                        </div>
                        <hr/>

                        
                        <h3 class="breadcrumb" id="vscode-step3">3. Add all content files to a deploy.json file</h3>

                        <div>
                            The json file must have a format similar to the following:
                            <pre>{
    "serialport":"COM3",
    "files": [{
        "DestinationFilePath": "I:\\filetoread.png",
        "SourceFilePath": "filetoread.png"
    }, {
        "DestinationFilePath": "I:\\smallfiletoread.png",
        "SourceFilePath": "smallfiletoread.png"
    }]
}</pre>
                            <div>
                                where each file that must be copied to the device has a <code>DestinationFilePath</code> property and a <code>SourceFilePath</code> property.<br/><br/>
                                The <code>SourceFilePath</code> property represents where the file that must be copied resides on your local disk. This is a path relative to where
                                the tool that copies the content files will run.
                            </div>
                            <div>
                                The <code>DestinationFilePath</code> property is where the file must reside on the device. Subdirectories are supported.
                            </div>
                            <div>
                                The drive used depends on the type of storage being used. If using the internal device storage, the drive is <code>I:\\</code>.
                            </div>
                            <ul>
                                <li><code>I:</code> Internal storage</li>
                                <li><code>D:</code> SD Card</li>
                                <li><code>E:</code> USB storage</li>
                            </ul>
                        </div>
                        <hr/>

                        <h3 class="breadcrumb" id="vscode-step4">4. Deploy the content files</h3>

                        <div>
                            <div>
                                Deploying the content files is done by running a <code>nanoff</code> dotnet tool.
                            </div>
                            <div>
                                Install the nanoff tool by running the command <code>dotnet tool install -g nanoff</code>
                            </div>
                            <div>
                                Once <code>nanoff</code> is installed, you can use it deploy content files by running: <code>nanoff --filedeployment deploy.json</code> where
                                <code>deploy.json</code> is the json file you made in <a href="#vscode-step3">step 3.</a>
                            </div>
                            <img src="img/nanoffdeploy.png" />

                            <div>
                                Once the command has completed, your content files will be deployed on the device.
                            </div>
                        </div>
                        -->

                        <h3 class="breadcrumb" id="vscode-step5">3. Success!</h3>
                        <div>
                            Congratulations! You have managed to deploy your first NanoFramework application. Now we need to make it do something!
                        </div>
                    </div>

                    <div class="tab-pane" id="bonus-exercise-tab-content" rold="tabpanel" aria-labelledby="bonusexercise-tab" tabindex="2">
                        <h3>Bonus round!</h3>

                        <div>
                            Done already? Waiting for everyone else to finish? Why not tackle some of these bonus challenges?
                        </div>

                        <h3 class="breadcrumb">1. Connect to the WiFi network</h3>
                        <div>
                            If you're using Visual Studio, you should have noticed that the date that was output by the log statement was very
                            incorrect. In fact, you might recognise the date (01/01/1970) as one of the typical Epoch dates.
                        </div>
                        <div>
                            This is because the ESP32 doesn't have a real-time clock to keep track of the date.
                        </div>
                        <div>
                            NanoFramework manages the date and time of devices by getting the current time once the device connects to a network with a
                            time server.
                        </div>
                        <div>
                            
                        </div>

                        <h3 class="breadcrumb">2. Modify the CSharp code to allow replacing tokens within the HTML with values from the device</h3>
                        <div>
                            The <code>program.cs</code> file is where the <code>WebServer</code> class is instantiated. It is this class that handles the HTTP
                            requests.
                        </div>
                        <div>
                            The next bonus exercise is to change the code that serves the static content files to replace the token from the previous example
                            (<code>%%NUMBEROFREQUESTS%%</code>) with a variable from the server.
                        </div>
                        <div>
                            Ther server should now keep a running total of the number of files it has served. When the <code>server.html</code> is requested, the server
                            must replace the <code>%%NUMBEROFREQUESTS%%</code> token with that running total. The value does not need to update dynamically, but when
                            then page is refreshed the most up-to-date value should be displayed.
                        </div>

                        <h3 class="breadcrumb">3. Profile the performance of serving static content files</h3>
                        <div>
                            For the last bonus exercise, see if you can come up with a way to measure the performance of the server when serving static content.
                        </div>
                        <div>
                            See if you can find rough numbers for:
                        </div>
                        <div>
                            <ul>
                                <li>Number of requests that can be handled concurrently</li>
                                <li>Failures per 1000 requests</li>
                                <li>Mean kbps</li>
                                <li>Does the size of the content files impact the results?</li>
                                <li>How would you add caching to the webserver?</li>
                            </ul>
                        </div>
                    </div>

                    <div class="footer-nav">
                        <a href="exercise2.html">Go to Exercise 2 &gt;</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/bootstrap.bundle.min.js"></script>
</body>
</html>