<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Escape room fun!</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>

<body>
    <div>
        <div class="container">
            <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <div class="container-fluid">
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Exercises</a>
                                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                    <li><a class="dropdown-item" href="exercise1.html">Exercise 1 - Intro to NanoFramework</a></li>
                                    <li><a class="dropdown-item active" href="exercise2.html">Exercise 2 - Turning devices on/off</a></li>
                                    <li><a class="dropdown-item" href="exercise3.html">Exercise 3 - Responding to HTTP requests</a></li>
                                    <li><a class="dropdown-item" href="exercise4.html">Exercise 4 - Intro to Azure Service Bus</a></li>
                                    <li><a class="dropdown-item" href="exercise5.html">Exercise 5 - Pub/Sub</a></li>
                                    <li><a class="dropdown-item" href="exercise6.html">Exercise 6 - Dealing with failures</a></li>
                                    <li><a class="dropdown-item" href="exercise7.html">Exercise 7 - Building an efficient pipeline</a></li>
                                    <li><a class="dropdown-item" href="exercise8.html">Exercise 8 - Message Timeouts</a></li>
                                    <li><a class="dropdown-item" href="exercise9.html">Exercise 9 - Rate Limiting</a></li>
                                    <li><a class="dropdown-item" href="exercise10.html">Exercise 10 - Delayed Delivery</a></li>
                                    <li><a class="dropdown-item" href="exercise11.html">Exercise 11 - Further patterns to learn</a></li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="https://github.com/WilliamBZA/1DayDistributedSystemsThroughPlay/tree/main/">Code Repo</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="https://github.com/WilliamBZA/1DayDistributedSystemsThroughPlay/tree/main/exercises/solutions">Solutions</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>

        <div class="container heading">
            <div>
                <h1>Exercise 2:</h1>
                <h4>Turn lights on and off</h4>
            </div>
        </div>
        
        <div class="container exercisedetails">
            <div class="col-lg-12">
                <ul class="nav nav-tabs" id="exercise-headings" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="gpio-tab" type="button" data-bs-toggle="tab" data-bs-target="#gpio-tab-content" role="tab" aria-controls="visualstudio-tab-content" aria-selected="false">GPIO</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="bonusexercise-tab" type="button" data-bs-toggle="tab" data-bs-target="#bonus-exercise-tab-content" role="tab" aria-controls="bonus-exercise-tab-content" aria-selected="true">Bonus exercises</button>
                    </li>
                </ul>
                
                <div class="tab-content" id="exerciseContent">
                    <div class="tab-pane show active" id="gpio-tab-content" role="tabpanel" aria-labelledby="gpio-tab" tabindex="0">
                        <h3>Turning a LED on/off</h3>

                        <div>
                            One of the aims of this workshop is to use escape room devices to teach distributed system concepts. Before we can get too involved with
                            distributed systems techniques, we first need to learn how to interact with some of the escape room devices.
                        </div>
                        <div>
                            TO do this, we're going to start with turning a simple LED on and off. 
                        </div>

                        <h3 class="breadcrumb" id="vs-step1">1. Turn the Red LED on when the device starts</h3>
                        <div>
                            Microcontrollers interact with electronic components through a variety of methods. One of the most common is via GPIO pins. GPIO stands
                            for General Purpose Input Output. These can be ON (HIGH) or OFF (LOW).
                        </div>
                        <div>
                            There are 2 LEDs connected to your device. The <span class="red">Red LED</span> is connected to <code>GPIO</code> pin <code>21</code>
                            and the <span class="blue">Blue LED</span> is connected to <code>GPIO</code> pin <code>4</code>.
                        </div>
                        <div>
                            To turn one of these LEDs on, we need to write a high value to the GPIO pin that the LED is connect to. Writing a high value to a GPIO pin
                            using NanoFramework involves 3 steps:

                            <ol>
                                <li>Create an instance of a <code>GpioController</code></li>
                                <li>Use the <code>GpioController</code> to open the pin</li>
                                <li>Write <code>PinValue.High</code> to the pin</li>
                            </ol>
                            </div>
                            <div><pre>
var gpioController = new GpioController(); // Create an inistance of a GpioController
var redLed = gpioController.OpenPin(21, PinMode.Output); // Use the GpioController to open the pin

redLed.Write(PinValue.High); // Write PinValue.High to the pin</pre>
                        </div>
                        <div>
                            Your first exercise is to turn the Red LED on when the device starts up.
                        </div>

                        <h3 class="breadcrumb" id="vs-step2">2. Toggle the Red and Blue LEDs every second</h3>
                        <div>
                            Next we're going to extend the exercise to also turn on the Blue LED. You already have an instance of a <code>GpioController</code>, so use that
                            to open the Blue LED PIN and validate that you can turn it on.
                        </div>
                        <div>
                            Once you've made sure you can turn the Blue LED on, change the code to turn it on while turning the Red LED off. That way, only 1 LED should
                            be on at a time. 
                        </div>
                        <div>
                            Now see if you can toggle the LEDs every second so that the Red LED will be on for 1 second, then it will turn off and the Blue LED will be on
                            for 1 second. This should repeat indefinitely so that the Red and Blue LEDs toggle on and off.
                        </div>

                        <h3 class="breadcrumb" id="vs-step3">3. Toggle the LEDs when a button is pushed</h3>
                        <div>
                            Instead of toggling every second, let's learn how to read a value from a GPIO pin.
                        </div>
                        <div>
                            The button on your device is connected to GPIO pin 22.
                        </div>
                        <div>
                            Reading from a GPIO pin is similar to writing to a pin:

                            <ol>
                                <li>Create an instance of a <code>GpioController</code></li>
                                <li>Use the <code>GpioController</code> to open the pin</li>
                                <li>Subscribe to tthe pin's <code>ValueChanged</code> event</li>
                            </ol>
                        </div>
                        <div>
                            <pre>
var gpioController = new GpioController(); // Create an inistance of a GpioController
var button = gpioController.OpenPin(22, PinMode.InputPullDown); // Use the GpioController to open the pin

button.ValueChanged += (s, e) => {
    Console.WriteLine($"{DateTime.UtcNow} - Button Pushed");
};</pre>
                        </div>
                        <div>
                            Use the <code>ValueChanged</code> callback to toggle the state of the LEDs when the button is pushed.
                        </div>
                    </div>

                    <div class="tab-pane" id="bonus-exercise-tab-content" rold="tabpanel" aria-labelledby="bonusexercise-tab" tabindex="2">
                        <h3>Bonus round!</h3>

                        <div>
                            Done already? Waiting for everyone else to finish? Why not tackle some of these bonus challenges?
                        </div>

                        <h3 class="breadcrumb">1. Debounce the input</h3>
                        <div>
                            Do you notice something weird about the toggling when you press the button? If it seems like your LEDs are toggling a bit too often, this
                            is likely related to "bouncing" of the input. This happens when the button doesn't quite make full contact all at once: the switching from
                            HIGH to LOW and the immediately from LOW to HIGH and vice versa until the button contact is completely made.
                        </div>
                        <div>
                            The technique to prevent this from happening is known as <code>Debouncing</code>. This is where you react to the button being pushed, and then
                            you pause all other input reading from that button for a few millliseconds (e.g. 100ms). This means that as the button makes it's first contact and triggers
                            a LOW to HIGH transition, your microcontroller ignores any other state transitions for that button for however long you defined.
                        </div>
                        <div>
                            See if you can debounce the input from your button.
                        </div>

                        <h3 class="breadcrumb">2. Toggle the LEDs only when both buttons are pressed</h3>
                        <div>
                            There are two buttons on your device. Change your code so that the LEDs toggle only if BOTH buttons are pushed.
                        </div>
                    </div>
                    <div class="footer-nav">
                        <a href="exercise1.html">&lt; Go to Exercise 1</a><a href="exercise3.html">Go to Exercise 3 &gt;</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/bootstrap.bundle.min.js"></script>
</body>
</html>